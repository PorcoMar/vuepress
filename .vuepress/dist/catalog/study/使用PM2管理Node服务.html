<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PorcoMar Site | ➹ 使用 PM2 管理 Node 服务</title>
    <meta name="description" content="Settle 🍀DUO in a golden house~👺">
    <link rel="shortcut icon" type="image/x-icon" href="https://gitee.com/uploads/6/1023506_PorcoMar.png?1500276509&quot; rel=&quot;shortcut icon">
    
    <link rel="preload" href="/assets/css/15.styles.7cddef4a.css" as="style"><link rel="preload" href="/assets/js/app.5f6376b3.js" as="script"><link rel="preload" href="/assets/js/2.bfbd795d.js" as="script"><link rel="prefetch" href="/assets/js/7.c2b6ae81.js"><link rel="prefetch" href="/assets/js/0.85ea7835.js"><link rel="prefetch" href="/assets/js/1.1530118e.js"><link rel="prefetch" href="/assets/js/3.6b624594.js"><link rel="prefetch" href="/assets/js/4.cf1e7f06.js"><link rel="prefetch" href="/assets/js/5.d592c203.js"><link rel="prefetch" href="/assets/js/6.e74f166f.js"><link rel="prefetch" href="/assets/js/8.706825be.js"><link rel="prefetch" href="/assets/js/9.1ddc9aaa.js"><link rel="prefetch" href="/assets/js/10.400ba2c7.js"><link rel="prefetch" href="/assets/js/11.91a8abcc.js"><link rel="prefetch" href="/assets/js/12.d9ad7544.js"><link rel="prefetch" href="/assets/js/13.e30c9632.js"><link rel="prefetch" href="/assets/js/14.66ea01bd.js">
    <link rel="stylesheet" href="/assets/css/15.styles.7cddef4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      PorcoMar Site
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/catalog/study/" class="nav-link router-link-active">Study</a></div><div class="nav-item"><a href="http://www.porcofish.net:1314/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div><div class="nav-item"><a href="https://gitee.com/PorcoMar" target="_blank" rel="noopener noreferrer" class="nav-link">Gitee</a></div><div class="nav-item"><a href="https://github.com/PorcoMar?tab=repositories" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/catalog/study/" class="nav-link router-link-active">Study</a></div><div class="nav-item"><a href="http://www.porcofish.net:1314/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div><div class="nav-item"><a href="https://gitee.com/PorcoMar" target="_blank" rel="noopener noreferrer" class="nav-link">Gitee</a></div><div class="nav-item"><a href="https://github.com/PorcoMar?tab=repositories" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>开发笔记</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/catalog/study/" class="sidebar-link">➹ study目录说明</a></li><li><a href="/catalog/study/vuepress使用说明.html" class="sidebar-link">➹ vuePress使用说明</a></li><li><a href="/catalog/study/微信授权和sdk加密算法.html" class="sidebar-link">➹ 微信授权和sdk加密算法</a></li><li><a href="/catalog/study/browserify+gulp自动编译打包.html" class="sidebar-link">➹ browserify+gulp自动编译打包</a></li><li><a href="/catalog/study/使用webpack配置MPA.html" class="sidebar-link">➹ 使用webpack配置MPA</a></li><li><a href="/catalog/study/Markdown笔记.html" class="sidebar-link">➹ Markdown笔记</a></li><li><a href="/catalog/study/vuex的理解.html" class="sidebar-link">➹ vuex的理解</a></li><li><a href="/catalog/study/WePY总结.html" class="sidebar-link">➹ WePY总结</a></li><li><a href="/catalog/study/mpvue-docs.html" class="sidebar-link">➹ mpvue-docs</a></li><li><a href="/catalog/study/一些常用的Linux远程操作命令记录.html" class="sidebar-link">➹ 一些常用的 Linux 远程操作命令记录</a></li><li><a href="/catalog/study/使用PM2管理Node服务.html" class="active sidebar-link">➹ 使用 PM2 管理 Node 服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/catalog/study/使用PM2管理Node服务.html#➣-简介" class="sidebar-link">➣ 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/catalog/study/使用PM2管理Node服务.html#使用-pm2-之前需要先进行安装：" class="sidebar-link">使用 PM2 之前需要先进行安装：</a></li><li class="sidebar-sub-header"><a href="/catalog/study/使用PM2管理Node服务.html#配置文件" class="sidebar-link">配置文件</a></li></ul></li></ul></li><li><a href="/catalog/study/yarn和npm的比较.html" class="sidebar-link">➹ yarn和npm的比较</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h2 id="➣-简介"><a href="#➣-简介" aria-hidden="true" class="header-anchor">#</a> ➣ 简介</h2><div class="warning custom-block"><p class="custom-block-title">PM2</p><p>PM2 是一个 Node 进程管理工具，可以用来帮助我们更好的管理 Node 服务。PM2 具有以下几个特性：</p><ul><li>动态监控文件变动，0秒热启动</li><li>对 CPU 进行负载均衡</li><li>监控 CPU、内存的使用状况</li><li>自动重启异常服务</li></ul></div><h3 id="使用-pm2-之前需要先进行安装："><a href="#使用-pm2-之前需要先进行安装：" aria-hidden="true" class="header-anchor">#</a> 使用 PM2 之前需要先进行安装：</h3><pre class="language-js"><code>yarn global add pm2
</code></pre><p>如果说 Nginx 是用于服务器间的负载均衡，那么 PM2 就是用于某个具体服务器之上的负载均衡，能够最大程度上帮助我们使用服务器资源，提高 Node 服务运行的性能，同时有助于提高服务的稳定性。
Node 是单线程的，因此无法充分使用服务器的 CPU，PM2 通过 Cluster 模式，能够帮助 Node 应用充分利用 CPU 资源。以下是官网的一张图片，十分形象：
<img src="https://upload-images.jianshu.io/upload_images/3831834-96a069562bea937e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><h3 id="配置文件"><a href="#配置文件" aria-hidden="true" class="header-anchor">#</a> 配置文件</h3><p>可以通过命令行直接运行 PM2，也可以提供一份配置文件。PM2 的配置文件比较简单，这里提供一份我常用的：</p><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;node-app&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;script&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
<span class="highlighted-line">    <span class="token string">&quot;watch&quot;</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>    <span class="token string">&quot;ignore-watch&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;instances&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;exec_mode&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;cluster&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;log_date_format&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;YYYY-MM-DD HH:mm Z&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;out_file&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;log/node-app.stdout.log&quot;</span>
<span class="token punctuation">}</span>
</code></pre><p>现在我们运行 pm2 start pm2.json --watch 就可以通过 PM2 启动 Node 服务了，并且具有监控文件变化自动重启的功能。</p><pre class="language-js"><code>pm2 start pm2<span class="token punctuation">.</span>json <span class="token operator">--</span>watch
</code></pre><p>常用命令</p><p>1.查看当前运行的服务</p><pre class="language-js"><code>pm2 list
</code></pre><p>控制台上的界面如下：</p><pre class="language-js"><code> Name                │ mode │ status │ ↺   │ cpu │ memory    │
├─────────────────────┼──────┼────────┼─────┼─────┼───────────┤
│ node_yizhen_website │ fork │ online │ <span class="token number">121</span> │ <span class="token number">0</span><span class="token operator">%</span>  │ <span class="token number">38.4</span> <span class="token constant">MB</span>   │
<span class="highlighted-line">│ qa_admin            │ fork │ online │ <span class="token number">65</span>  │ <span class="token number">0</span><span class="token operator">%</span>  │ <span class="token number">61.7</span> <span class="token constant">MB</span>   │</span>│ shangjia<span class="token operator">-</span>app        │ fork │ online │ <span class="token number">299</span> │ <span class="token number">0</span><span class="token operator">%</span>  │ <span class="token number">73.6</span> <span class="token constant">MB</span> 

</code></pre><p>2.监控服务</p><pre class="language-js"><code>pm2 monit
</code></pre><p>3.重启服务</p><pre class="language-js"><code>pm2 restart xxx<span class="token punctuation">.</span>json
</code></pre><p>4.平滑重启</p><pre class="language-js"><code>pm2 reload xxx<span class="token punctuation">.</span>json
</code></pre><p>5.停止所有服务</p><pre class="language-js"><code>pm2 stop all
</code></pre><p>在线监控</p><p>PM2 官网提供了在线监控 Node 服务的功能，功能十分强大。该功能是付费的，普通用户只能监控一个项目，但对于平常学习使用是足够了。
要使用此项服务，首先需要到 <a href="https://keymetrics.io/" target="_blank" rel="noopener noreferrer">https://keymetrics.io/</a> 注册一个账号。
注册之后点击登录，首次登陆可以创建一个新的 Bucket，用以监控 Node 服务：
<img src="https://upload-images.jianshu.io/upload_images/3831834-7f40c96dd976f328.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><p>点击按钮新建一个 Bucket，填写任务名：
<img src="https://upload-images.jianshu.io/upload_images/3831834-0716e55b048eadea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><p>创建 Bucket 后，会分配一个唯一的串号，复制相应的命令在服务器上执行即可：
<img src="https://upload-images.jianshu.io/upload_images/3831834-eb37866f8278367c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><p>执行完 pm2 link 命令后，会在控制台输出一个 URL：
<img src="https://upload-images.jianshu.io/upload_images/3831834-ebb7eef669fb6793.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700"></p><p>在浏览器中打开这个链接地址，就可以在线监控 Node 服务的运行情况了：
<img src="https://upload-images.jianshu.io/upload_images/3831834-43f358d95f3ad514.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700">
完。</p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/catalog/study/一些常用的Linux远程操作命令记录.html" class="prev">
          ➹ 一些常用的 Linux 远程操作命令记录
        </a></span><span class="next"><a href="/catalog/study/yarn和npm的比较.html">
          ➹ yarn和npm的比较
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/2.bfbd795d.js" defer></script><script src="/assets/js/app.5f6376b3.js" defer></script>
  </body>
</html>
